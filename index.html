<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Ouvinte Repórter</title>
<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #001a33;
  color: #fff;
}
h2 {
  text-align: center;
  font-size: 32px;
  margin: 20px 0 5px;
}
p.sub {
  text-align: center;
  font-size: 20px;
  color: #cce0ff;
  margin-bottom: 15px;
}
#container {
  position: relative;
  max-width: 100%;
  height: 420px;
  overflow: hidden;
}
#track {
  display: flex;
  height: 100%;
  transition: transform 0.6s ease;
}
.slide {
  min-width: 100%;
  position: relative;
}
.slide img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
.caption {
  position: absolute;
  bottom: 0;
  width: 100%;
  padding: 20px;
  background: linear-gradient(transparent, rgba(0,0,0,0.85));
  font-size: 20px;
  text-align: center;
}
.loading {
  text-align: center;
  margin-top: 180px;
  font-size: 18px;
}
</style>
</head>
<body>

<h2>Ouvinte Repórter</h2>
<p class="sub">A voz da população mostrando os problemas da cidade</p>

<div id="container">
  <div id="track">
    <div class="loading">Carregando denúncias...</div>
  </div>
</div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQF6Pkq50WVPuYUz4OpZ8PcXUJzmKuy1WfAFWyiMET4XhVZaeWIVfy8SIgeuHs77jwi1gRHHHR0VmW-/pub?output=csv";

let index = 0;
let total = 0;

function extractId(url) {
  if (!url) return null;
  if (url.includes("/d/")) return url.split("/d/")[1].split("/")[0];
  if (url.includes("id=")) return url.split("id=")[1].split("&")[0];
  return null;
}

async function loadData() {
  const res = await fetch(CSV_URL + "&t=" + Date.now());
  const text = await res.text();
  const rows = text.split("\n").map(r => r.split(","));
  const track = document.getElementById("track");
  track.innerHTML = "";

  rows.slice(1).forEach(row => {
    const texto = row[4];
    const link = row[5];
    const status = (row[8] || "").trim().toUpperCase();

    if (status === "SIM" && link) {
      const id = extractId(link);
      if (!id) return;
      const img = `https://drive.google.com/uc?export=view&id=${id}`;

      track.innerHTML += `
        <div class="slide">
          <img src="${img}">
          <div class="caption">${texto}</div>
        </div>`;
    }
  });

  total = document.querySelectorAll(".slide").length;

  if (total === 0) {
    track.innerHTML = '<div class="loading">Nenhuma denúncia aprovada no momento.</div>';
  } else {
    setInterval(() => next(), 5000);
  }
}

function next() {
  index = (index + 1) % total;
  document.getElementById("track").style.transform = `translateX(-${index * 100}%)`;
}

loadData();
</script>

</body>
</html>
