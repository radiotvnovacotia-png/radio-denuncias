<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Ouvinte Repórter</title>
<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #001a33;
  color: #fff;
}
h2 {
  text-align: center;
  font-size: 32px;
  margin: 20px 0 5px;
}
p.sub {
  text-align: center;
  font-size: 20px;
  color: #cce0ff;
  margin-bottom: 15px;
}
#container {
  position: relative;
  max-width: 100%;
  height: 500px; /* Aumentei um pouco para caber mais texto se necessário */
  overflow: hidden;
}
#track {
  display: flex;
  height: 100%;
  transition: transform 0.6s ease;
}
.slide {
  min-width: 100%;
  position: relative;
}
.slide img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
.caption {
  position: absolute;
  bottom: 0;
  width: 100%;
  padding: 20px;
  background: linear-gradient(transparent, rgba(0,0,0,0.9));
  font-size: 18px;
  text-align: center;
  box-sizing: border-box;
}
.caption b {
  display: block;
  font-size: 20px;
  color: #ffcc00; /* Cor de destaque para o Assunto/Local */
  margin-bottom: 5px;
}
.loading {
  text-align: center;
  width: 100%;
  margin-top: 180px;
  font-size: 18px;
}
</style>
</head>
<body>

<h2>Ouvinte Repórter</h2>
<p class="sub">A voz da população mostrando os problemas da cidade</p>

<div id="container">
  <div id="track">
    <div class="loading">Carregando denúncias...</div>
  </div>
</div>

<script>
// URL da sua planilha publicada como CSV
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQF6Pkq50WVPuYUz4OpZ8PcXUJzmKuy1WfAFWyiMET4XhVZaeWIVfy8SIgeuHs77jwi1gRHHHR0VmW-/pub?output=csv";

let index = 0;
let total = 0;

function extractId(url) {
  if (!url) return null;
  const match = url.match(/(?:\/d\/|id=)([\w-]+)/);
  return match ? match[1] : null;
}

function parseCSV(text) {
  const regex = /,(?=(?:(?:[^"]*"){2})*[^"]*$)/;
  return text.split('\n').map(line => line.split(regex).map(val => val.replace(/^"|"$/g, '').trim()));
}

async function loadData() {
  try {
    const res = await fetch(CSV_URL + "&t=" + Date.now());
    const text = await res.text();
    const rows = parseCSV(text);
    const track = document.getElementById("track");
    
    let htmlContent = "";

    // Começa do 1 para pular o cabeçalho
    rows.slice(1).forEach(row => {
      const local = row[2];      // Coluna C
      const assunto = row[3];    // Coluna D
      const descricao = row[4];  // Coluna E
      const linkFoto = row[7];   // Coluna H
      const status = (row[9] || "").toUpperCase(); // Coluna J

      if (status === "SIM" && linkFoto) {
        const id = extractId(linkFoto);
        if (id) {
          const imgUrl = `https://drive.google.com/uc?export=view&id=${id}`;
          htmlContent += `
            <div class="slide">
              <img src="${imgUrl}" onerror="this.src='https://via.placeholder.com/800x500?text=Imagem+Privada+ou+Inexistente'">
              <div class="caption">
                <b>${assunto} - ${local}</b>
                ${descricao}
              </div>
            </div>`;
        }
      }
    });

    if (htmlContent === "") {
      track.innerHTML = '<div class="loading">Nenhuma denúncia aprovada no momento.</div>';
    } else {
      track.innerHTML = htmlContent;
      total = document.querySelectorAll(".slide").length;
      if (total > 1) {
        setInterval(next, 6000); // Troca a cada 6 segundos
      }
    }
  } catch (error) {
    document.getElementById("track").innerHTML = '<div class="loading">Erro ao carregar dados da planilha.</div>';
  }
}

function next() {
  if (total === 0) return;
  index = (index + 1) % total;
  document.getElementById("track").style.transform = `translateX(-${index * 100}%)`;
}

loadData();
</script>

</body>
</html>
